<div class="profile-container">
    <!-- Header -->
    <div class="profile-header">
        <h1><mat-icon>account_circle</mat-icon> My Profile</h1>
        <button mat-raised-button color="warn" (click)="logout()">
            <mat-icon>logout</mat-icon> Logout
        </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
        <mat-spinner></mat-spinner>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!loading" class="profile-content">

        <!-- Profile Information Card -->
        <mat-card class="profile-card">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>person</mat-icon> Profile Information
                </mat-card-title>
                <div class="header-actions">
                    <button *ngIf="!editMode" mat-icon-button color="primary" (click)="toggleEditMode()"
                        matTooltip="Edit Profile">
                        <mat-icon>edit</mat-icon>
                    </button>
                </div>
            </mat-card-header>

            <mat-card-content>
                <form [formGroup]="profileForm">
                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Full Name</mat-label>
                            <input matInput formControlName="fullName" [readonly]="!editMode">
                            <mat-icon matPrefix>badge</mat-icon>
                            <mat-error *ngIf="fullName?.hasError('required')">
                                Full name is required
                            </mat-error>
                            <mat-error *ngIf="fullName?.hasError('minlength')">
                                Name must be at least 2 characters
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Email</mat-label>
                            <input matInput formControlName="email" type="email">
                            <mat-icon matPrefix>email</mat-icon>
                            <mat-hint>Email cannot be changed</mat-hint>
                        </mat-form-field>
                    </div>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Phone Number</mat-label>
                            <input matInput formControlName="phoneNumber" [readonly]="!editMode" maxlength="10">
                            <mat-icon matPrefix>phone</mat-icon>
                            <mat-error *ngIf="phoneNumber?.hasError('required')">
                                Phone number is required
                            </mat-error>
                            <mat-error *ngIf="phoneNumber?.hasError('pattern')">
                                Please enter a valid 10-digit phone number
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="form-row" *ngIf="userProfile">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Role</mat-label>
                            <input matInput [value]="userProfile.role" readonly>
                            <mat-icon matPrefix>verified_user</mat-icon>
                        </mat-form-field>
                    </div>

                    <!-- Action Buttons for Edit Mode -->
                    <div *ngIf="editMode" class="action-buttons">
                        <button mat-raised-button color="primary" (click)="saveProfile()"
                            [disabled]="profileForm.invalid">
                            <mat-icon>save</mat-icon> Save Changes
                        </button>
                        <button mat-stroked-button (click)="toggleEditMode()">
                            <mat-icon>cancel</mat-icon> Cancel
                        </button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>

        <!-- Change Password Card -->
        <mat-card class="password-card">
            <mat-card-header>
                <mat-card-title>
                    <mat-icon>lock</mat-icon> Security
                </mat-card-title>
            </mat-card-header>

            <mat-card-content>
                <button *ngIf="!changingPassword" mat-raised-button color="accent" (click)="togglePasswordChange()">
                    <mat-icon>vpn_key</mat-icon> Change Password
                </button>

                <!-- Password Change Form -->
                <form *ngIf="changingPassword" [formGroup]="passwordForm" class="password-form">
                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Current Password</mat-label>
                            <input matInput type="password" formControlName="currentPassword">
                            <mat-icon matPrefix>lock_outline</mat-icon>
                            <mat-error *ngIf="currentPassword?.hasError('required')">
                                Current password is required
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>New Password</mat-label>
                            <input matInput type="password" formControlName="newPassword">
                            <mat-icon matPrefix>lock</mat-icon>
                            <mat-error *ngIf="newPassword?.hasError('required')">
                                New password is required
                            </mat-error>
                            <mat-error *ngIf="newPassword?.hasError('minlength')">
                                Password must be at least 6 characters
                            </mat-error>
                            <mat-error *ngIf="newPassword?.hasError('pattern')">
                                Password must contain uppercase, lowercase, number, and special character
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Confirm New Password</mat-label>
                            <input matInput type="password" formControlName="confirmPassword">
                            <mat-icon matPrefix>lock_clock</mat-icon>
                            <mat-error *ngIf="confirmPassword?.hasError('required')">
                                Please confirm your password
                            </mat-error>
                            <mat-error *ngIf="confirmPassword?.hasError('passwordMismatch')">
                                Passwords do not match
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="action-buttons">
                        <button mat-raised-button color="primary" (click)="changePassword()"
                            [disabled]="passwordForm.invalid">
                            <mat-icon>check</mat-icon> Change Password
                        </button>
                        <button mat-stroked-button (click)="togglePasswordChange()">
                            <mat-icon>cancel</mat-icon> Cancel
                        </button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>

    </div>
</div>